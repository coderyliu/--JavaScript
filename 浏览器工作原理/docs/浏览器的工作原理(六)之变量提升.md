# 浏览器的工作原理(六)之Javascript代码是按照顺序执行的吗？

​	今天在该模块的文章，我们主要讲解执行上下文相关的内容。那为什么先讲执行上下文呢？它这么重要吗？可

以这么说，只有理解了 JavaScrip 的执行上下文，你才能更好地理解 JavaScript 语言本身，比如变量提升、作用域

和闭包等。不仅如此，理解执行上下文和调用栈的概念还能助你成为一名更合格的前端开发者。不过由于我们不是

专门讲 JavaScript 语言的，所以我并不会对 JavaScript 语法本身做过多介绍。本文主要是从 JavaScript 的顺序执

行讲起，然后一步步带你了解 JavaScript 是怎么运行的。

​	接下来咱们先看段代码，你觉得下面这段代码输出的结果是什么？

```javascript
showName()
console.log(myname)
var myname = 'coder'
function showName() {
    console.log('函数showName被执行');
}
```

​	使用过 JavaScript 开发的程序员应该都知道，JavaScript 是按顺序执行的。若按照这个逻辑来理解的话，那么：

- 当执行到第 1 行的时候，由于函数 showName 还没有定义，所以执行应该会报错；

- 同样执行第 2 行的时候，由于变量 myname 也未定义，所以同样也会报错。

  然而实际执行结果却并非如此， 如下图：

![image-20220503185733598](D:\截图\22_浏览器原理\image-20220503185733598.png)

​	第 1 行输出“函数 showName 被执行”，第 2 行输出“undefined”，这和前面想象中的顺序执行有点不一样啊！

通过上面的执行结果，你应该已经知道了函数或者变量可以在定义之前使用，那如果使用没有定义的变量或者函

数，JavaScript 代码还能继续执行吗？为了验证这点，我们可以删除第 3 行变量 myname 的定义，如下所示：

```jsx
showName()
console.log(myname)
function showName() {
    console.log('函数showName被执行');
}
```

​	然后再次执行这段代码时，JavaScript 引擎就会报错，结果如下：

![image-20220503185941214](D:\截图\22_浏览器原理\image-20220503185941214.png)

​	从上面两段代码的执行结果来看，我们可以得出如下三个结论。

- 1.在执行过程中，若使用了未声明的变量，那么 JavaScript 执行会报错。
- 2.在一个变量定义之前使用它，不会出错，但是该变量的值会为 undefined，而不是定义时的值。
- 3.在一个函数定义之前使用它，不会出错，且函数能正确执行。

​	第一个结论很好理解，因为变量没有定义，这样在执行 JavaScript 代码时，就找不到该变量，所以 JavaScript 会抛出错误。但是对于第二个和第三个结论，就挺让人费解的：变量和函数为什么能在其定义之前使用？这似乎表明 JavaScript 代码并不是一行一行执行的。同样的方式，变量和函数的处理结果为什么不一样？比如上面的执行结果，提前使用的 showName 函数能打印出来完整结果，但是提前使用的 myname 变量值却是 undefined，而不是定义时使用的“coder”这个值。

### 变量提升（Hoisting）

​	要解释这两个问题，你就需要先了解下什么是变量提升。不过在介绍变量提升之前，我们先通过下面这段代

码，来看看什么是 JavaScript 中的声明和赋值。

```jsx
var myname = 'coder'
```

​	这段代码你可以把它看成是两行代码组成的：var myname //声明部分myname = 'coder' //赋值部分

​	**所谓的变量提升，是指在 JavaScript 代码执行过程中，JavaScript 引擎把变量的声明部分和函数的声明部分提升到代码开头的“行为”。变量被提升后，会给变量设置默认值，这个默认值就是我们熟悉的 undefined。**



### **JavaScript 代码的执行流程**

​	从概念的字面意义上来看，“变量提升”意味着变量和函数的声明会在物理层面移动到代码的最前面，正如我们所

模拟的那样。但这并不准确。实际上变量和函数声明在代码里的位置是不会改变的，而且是在编译阶段被 

JavaScript 引擎放入内存中。对，你没听错，一段 JavaScript 代码在执行之前需要被 JavaScript 引擎编译，编译完

成之后，才会进入执行阶段。大致流程你可以参考下图：

![image-20220503190922835](D:\截图\22_浏览器原理\image-20220503190922835.png)

**函数提升要比变量提升的优先级要高一些，且不会被变量声明覆盖，但是会被变量赋值之后覆盖。**